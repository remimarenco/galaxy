{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","UTILS","BASE_MVC","logNamespace","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","defaults","model_class","id","name","state","deleted","urlRoot","Galaxy","root","initialize","historyJSON","contentsJSON","options","this","logger","log","contents","HistoryContents","historyId","get","_setUpListeners","updateTimeoutId","on","model","xhr","msg","details","errorHandler","listenTo","trigger","apply","concat","jQuery","makeArray","arguments","newId","clearUpdateTimeout","nice_size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","contentsCount","reduce","values","memo","num","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","running","visibleAndUndeleted","searchAttributes","searchAliases","title","tag","_getSizeAndRunning","fetch","data","$","param","keys","refresh","self","lastUpdateTime","Date","fetchUpdated","done","bind","checkForUpdates","_delayThenUpdate","setTimeout","delay","UPDATE_DELAY","clearTimeout","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","history","post","then","response","newHistory","setAsCurrent","getJSON","toString","getHistoryData","getHistory","ajax","isEmpty","historyData","empty","getContents","isFunction","detailIdsFn","hdcaDetailIds","v","join","df","Deferred","historyFn","contentsFn","historyXHR","json","notify","status","fail","reject","contentsXHR","resolve","ControlledFetchMixin","_buildFetchData","traditional","Collection","_fetchOptions","fetchDefaults","_fetchDefaults","pick","filters","has","_buildFetchFilters","filterMap","q","qv","each","k","push","HistoryCollection","DEFAULT_ORDER","sortOrders","update_time","getter","h","asc","update_time-asc","name-dsc","size","size-asc","models","includeDeleted","setOrder","order","currentHistoryId","allFetched","setUpListeners","url","view","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","sort","collection","sortOrder","isUndefined","comparator","a","b","fetchOptions","offset","limit","fetchData","numFetched","isArray","create","hdas","historyOptions","unshift","silent","reset"],"mappings":"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"}